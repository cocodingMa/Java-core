## CPU Cache

### 前言

CPU

### CPU Cache概述
CPU缓存（Cache Memory）位于CPU与内存之间小而快的存储设备，它的容量比内存小但交换速度快。在缓存中的数据是内存中的一小部分，但这一小部分是短时间内CPU即将访问的，当CPU调用大量数据时，就可避开内存直接从缓存中调用，从而加快读取速度。存储器系统是一个具有不同容量，成本和访问时间的存储层次结构

存储器层次结构中的示意如下图:

![cpucache](http://jijiantuku-cocoding.oss-cn-shanghai.aliyuncs.com/18-8-30/211875.jpg)

现在的大多数计算机系统的CPU Cache都具有三级缓存即L1, L2, L3。每一层缓存都来自下一层缓存的一部分，三级缓存技术难度和制造成本是相对递减的，所以其容量也是相对递增的。不同储存技术访问时间差异很大，L1是最接近CPU的一级，他的速度要跟上CPU的速度，往往很小，几十k的大小。当L1中读取不到数据，才会依次从L2，L3或者内存中读取。




### CPU Cache 实例
1. 示例一

```

```

### 缓存行和伪共享

缓存行是缓存的最小单元，一般是2的n次方字节，在MESI协议中有四种状态 `M：被修改的(Modified)`, `E：独享的(Exclusive)`, `S：共享的(Shared)`, `I：无效的(Invalid)`

`Modified`：当前CPU cache拥有最新数据（最新的cache line），其他CPU拥有失效数据（cache line的状态是invalid），虽然当前CPU中的数据和主存是不一致的，但是以当前CPU的数据为准；

`Exclusive`：只有当前CPU中有数据，其他CPU中没有改数据，当前CPU的数据和主存中的数据是一致的；

`Shared`：当前CPU和其他CPU中都有共同数据，并且和主存中的数据一致；

`Invalid`：当前CPU中的数据失效，数据应该从主存中获取，其他CPU中可能有数据也可能无数据，当前CPU中的数据和主存被认为是不一致的；

状态转换图：


### 缓存行填充





